import time
import codecs
t_start=time.time()
from SN_RESTful_Test.snextract import extractwithruns
from prettytable import PrettyTable
import datetime
url = "https://kpnzbk.service-now.com/api/now/table/sys_audit"
sysparm_fields="documentkey,fieldname,newvalue,oldvalue,reason,sys_created_by,sys_created_on,sys_id,tablename,user,sys_updated_on"
sysparm_query = "sys_updated_on>=2018.11.02 00:00:00^sys_updated_on<2018.11.02 01:00:00"
response=extractwithruns(sysparm_query,sysparm_fields).text
file = codecs.open("extractwithtime.xml", "w", "utf-8")
file.write(response)
file.close()
import lxml.etree as etrees
x = etrees.parse("extractwithtime.xml")
root = x.getroot()
result = len(root.getchildren())
root.getchildre
with open('pretty.xml', 'wb') as f:
    f.write(etrees.tostring(x, pretty_print=True))
print(result)



import requests
import time
def extractwithruns(sysparm_query='',sysparm_fields='',sysparm_limit='20000',filename='xml_file.xml',location='',runs=10,start=None,end=None):

    url = "https://kpnzbk.service-now.com/api/now/table/sys_audit"
    querystring = {"sysparm_query":sysparm_query ,"sysparm_fields":sysparm_fields, "sysparm_limit":sysparm_limit}

    proxyDict = {
        "http": "http://kundu503:pass@@ccaintra.kpnnl.local:8080",
        "https": "http://kundu503:pass@@ccaintra.kpnnl.local:8080",
        "ftp": "http://kundu503:pass@@ccaintra.kpnnl.local:8080"
    }

    headers = {
        'accept': "application/xml",
        'authorization': "Basic RlJBRE0uUkNSOlJhbWFAY3QkMTA=",
        'cache-control': "no-cache",
        'postman-token': "42f8be6b-de8c-b8fc-36e6-b8864668099d"
    }
    response = requests.request("GET", url, headers=headers, params=querystring, proxies=proxyDict)
    return response

